"X1","X2","X3","X4","X5","X6","X7","X8","X9","X10"
"dataframe","dis","","","","",,,,
"tablename","tblDIS","","","","",,,,
"id","patient","","","","",,,,
"expected","patient","dis_id","dis_d","dis_ed","dis_wd",,,,
"optional","dis_d_a","dis_ed_a","","","",,,,
"validate","extravar","","","","",,,,
"validate","missvar","","","","",,,,
"validate","notdate","dis_d","","","",,,,
"validate","notdate","dis_ed","","","",,,,
"validate","missingvalue","dis_id","","","",,,,
"validate","missingvalue","dis_d","","","",,,,
"transform","convertdate","dis_d","","","",,,,
"transform","convertdate","dis_ed","","","",,,,
"branch","exists('basic')","","","","",,,,
"transform","merge","basdis","basic","patient","birth_d",,,,
"transform","convertdate","birth_d","basdis","","",,,,
"validate","outoforder","birth_d","dis_d","tblBAS","table::basdis",,,,
"validate","outoforder","birth_d","dis_ed","tblBAS","table::basdis",,,,
"branch","END","","","","",,,,
"branch","exists('ltfu')","","","","",,,,
"transform","merge","ltfudis","ltfu","patient","death_d",,,,
"transform","convertdate","death_d","ltfudis","","",,,,
"validate","outoforder","dis_d","death_d","tblLTFU","table::ltfudis",,,,
"validate","outoforder","dis_ed","death_d","tblLTFU","table::ltfudis",,,,
"branch","END","","","","",,,,
"validate","outoforder","dis_d","dis_ed","","",,,,
"validate","futuredate","dis_d","","","",,,,
"validate","futuredate","dis_ed","","","",,,,
"loop","iter","na.omit(unique(dis$dis_id))","","","",,,,
"transform","assign","dis_sub","dis[dis$id %in% 'iter',]","","",,,,
"validate","queryduplicates","patient","dis_d","&dis_id=iter","table::dis_sub",,,,
"loop","END","","","","",,,,
"validate","notnumeric","dis_wd","","","",,,,
"validate","badcodes","dis_id","dis_id_codebook$code","","",,,,
"validate","badcodes","dis_wd","dis_wd_codebook$code","","",,,,
"validate","badcodes","dis_d_a","c('<','>','D','M','Y','U')","","",,,,
"validate","badcodes","dis_ed_a","c('<','>','D','M','Y','U')","","",,,,
"validate","badrecord","patient","dis","basic","",,,,

## QUERY ANY EVENT THAT IS RECORDED TWICE, same DIS_ID, and DIS_D withing 6 months 
if(exists("dis_d",dis) & exists("dis_id",dis)){
    qdis <- dis[with(dis,order(patient,dis_id,dis_d)),]
    qdis <- qdis[!is.na(qdis$dis_d) & !is.na(qdis$dis_id),]
    qdis$patient_dis_id <- paste(qdis$patient,qdis$dis_id,sep="-")
        qdis$disdelta <- with(qdis,unsplit(lapply(split(dis_d, patient_dis_id), FUN=function(x) c(NA, diff(x))), patient_dis_id))
        recerr <- which(!is.na(qdis$disdelta) & qdis$disdelta/365.25 < 0.5) ## LESS THAN 6 MONTHS APART
    if(length(recerr)>0){
        query <- data.frame(qdis$patient[recerr],
                tablename,
                "dis_id",
                "Logic",
                "Out of Range",
                paste(paste0("dis_d=",qdis$dis_d[recerr-1]),paste0("dis_id=",qdis$dis_id[recerr-1]),
                      paste0("dis_d=",qdis$dis_d[recerr]),  paste0("dis_id=",qdis$dis_id[recerr]),sep="&"),
                stringsAsFactors=FALSE)
        names(query) <- names(emptyquery)
        assign(paste("query",index,sep=""),query,envir=globalenv()); index <<- index + 1
    }
}
